# RAG Chatbot Flow Diagram

## ðŸŽ¯ Quick Reference Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG CHATBOT FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER QUESTION
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat UI        â”‚  "What are fever symptoms?"
â”‚  (Frontend)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP POST
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /api/chat      â”‚  1. Receives message
â”‚  (API Route)    â”‚  2. Calls FAISS
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  3. Calls Genkit
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FAISS Service  â”‚  â”‚  Genkit Flow    â”‚
â”‚  (Retrieval)    â”‚  â”‚  (Generation)   â”‚
â”‚                 â”‚  â”‚                 â”‚
â”‚  - Search       â”‚  â”‚  - Format promptâ”‚
â”‚  - Return       â”‚  â”‚  - Call Gemini  â”‚
â”‚    context      â”‚  â”‚  - Return answerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Response   â”‚  { response, sources }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat UI        â”‚  Displays answer
â”‚  (Frontend)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“‹ Detailed Sequence Diagram

```
User          Chat UI         API Route      FAISS        Genkit      Gemini
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚â”€â”€Questionâ”€â”€â”€>â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚â”€â”€POST /api/â”€â”€â”€>â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚   chat         â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚â”€â”€POST /â”€â”€â”€â”€>â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚   search    â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚â”€â”€Embedâ”€â”€>  â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚  (Google)  â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚<â”€Vectorâ”€â”€â”€â”€â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚â”€â”€Searchâ”€â”€â”€>â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚  (Index)   â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚<â”€â”€Resultsâ”€â”€â”€â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚â”€â”€chatWithâ”€â”€>â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚   RAG()     â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚â”€â”€Promptâ”€â”€>â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚â”€â”€Genâ”€â”€>â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚<â”€Answerâ”€â”€â”€â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚<â”€â”€Responseâ”€â”€â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚<â”€JSON Responseâ”€â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚<â”€â”€Answerâ”€â”€â”€â”€â”€â”‚                â”‚             â”‚            â”‚           â”‚
 â”‚              â”‚                â”‚             â”‚            â”‚           â”‚
```

---

## ðŸ”„ Complete RAG Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RETRIEVAL PHASE (FAISS)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Query: "What are fever symptoms?"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Text         â”‚
â”‚  "What are fever    â”‚
â”‚   symptoms?"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Embedding Service  â”‚
â”‚  (Google API)       â”‚
â”‚                     â”‚
â”‚  Text â†’ Vector      â”‚
â”‚  [0.123, -0.456,    â”‚
â”‚   0.789, ...]       â”‚
â”‚  (768 dimensions)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FAISS Search       â”‚
â”‚                     â”‚
â”‚  1. Search          â”‚
â”‚     diseases_index  â”‚
â”‚     â†’ Top 5 results â”‚
â”‚                     â”‚
â”‚  2. Search          â”‚
â”‚     records_index   â”‚
â”‚     (filtered by    â”‚
â”‚      userId)        â”‚
â”‚     â†’ Top 5 results â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Retrieved Context  â”‚
â”‚                     â”‚
â”‚  Diseases:          â”‚
â”‚  - Fever            â”‚
â”‚  - Symptoms: ...    â”‚
â”‚  - Treatments: ...  â”‚
â”‚                     â”‚
â”‚  Records:           â”‚
â”‚  - Lab report ...   â”‚
â”‚  - Date: ...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUGMENTATION PHASE (Context Assembly)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Retrieved Context
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Format Context     â”‚
â”‚                     â”‚
â”‚  Diseases:          â”‚
â”‚  "Disease 1: Fever  â”‚
â”‚   Symptoms: ...     â”‚
â”‚   Treatments: ..."  â”‚
â”‚                     â”‚
â”‚  Records:           â”‚
â”‚  "Record 1: ...     â”‚
â”‚   Content: ..."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Prompt      â”‚
â”‚                     â”‚
â”‚  System: "You are   â”‚
â”‚   a health          â”‚
â”‚   assistant..."     â”‚
â”‚                     â”‚
â”‚  Context:           â”‚
â”‚  [Retrieved info]   â”‚
â”‚                     â”‚
â”‚  History:           â”‚
â”‚  [Previous msgs]    â”‚
â”‚                     â”‚
â”‚  User: "What are    â”‚
â”‚   fever symptoms?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GENERATION PHASE (Gemini)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Formatted Prompt
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gemini API         â”‚
â”‚                     â”‚
â”‚  Input:             â”‚
â”‚  - System prompt    â”‚
â”‚  - Retrieved        â”‚
â”‚    context          â”‚
â”‚  - User question    â”‚
â”‚                     â”‚
â”‚  Processing:        â”‚
â”‚  - Understands      â”‚
â”‚    context          â”‚
â”‚  - Generates        â”‚
â”‚    answer           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generated Response â”‚
â”‚                     â”‚
â”‚  "Based on our      â”‚
â”‚   knowledge base,   â”‚
â”‚   fever symptoms    â”‚
â”‚   include:          â”‚
â”‚   - Elevated        â”‚
â”‚     temperature     â”‚
â”‚   - ..."            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Final Response     â”‚
â”‚                     â”‚
â”‚  {                  â”‚
â”‚    answer: "...",   â”‚
â”‚    sources: [       â”‚
â”‚      "Disease DB:   â”‚
â”‚       Fever"        â”‚
â”‚    ]                â”‚
â”‚  }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ—‚ï¸ Data Flow in Detail

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA TRANSFORMATIONS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. TEXT â†’ VECTOR (Embedding)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Input:  "What are fever symptoms?"       â”‚
   â”‚                                            â”‚
   â”‚ Process:                                   â”‚
   â”‚ - Tokenize text                            â”‚
   â”‚ - Send to Google Embedding API             â”‚
   â”‚ - Receive 768-dim vector                   â”‚
   â”‚                                            â”‚
   â”‚ Output: [0.123, -0.456, 0.789, ...]       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. VECTOR â†’ SIMILAR VECTORS (FAISS Search)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Input:  [0.123, -0.456, 0.789, ...]      â”‚
   â”‚                                            â”‚
   â”‚ Process:                                   â”‚
   â”‚ - Calculate cosine similarity              â”‚
   â”‚ - Find top K similar vectors               â”‚
   â”‚ - Return vector IDs                        â”‚
   â”‚                                            â”‚
   â”‚ Output: [id: 42, id: 15, id: 89, ...]    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. VECTOR IDs â†’ METADATA (Lookup)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Input:  [42, 15, 89]                      â”‚
   â”‚                                            â”‚
   â”‚ Process:                                   â”‚
   â”‚ - Lookup in metadata JSON                  â”‚
   â”‚ - Extract disease/record info              â”‚
   â”‚                                            â”‚
   â”‚ Output: {                                  â”‚
   â”‚   42: { name: "Fever", ... },             â”‚
   â”‚   15: { name: "Infection", ... },         â”‚
   â”‚   89: { ... }                              â”‚
   â”‚ }                                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. METADATA â†’ FORMATTED CONTEXT
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Input:  Metadata objects                  â”‚
   â”‚                                            â”‚
   â”‚ Process:                                   â”‚
   â”‚ - Format as readable text                  â”‚
   â”‚ - Combine into context string              â”‚
   â”‚                                            â”‚
   â”‚ Output:                                    â”‚
   â”‚ "Disease 1: Fever                         â”‚
   â”‚  Symptoms: ...                            â”‚
   â”‚  Treatments: ..."                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. CONTEXT + QUERY â†’ AI RESPONSE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Input:  Context + User Query              â”‚
   â”‚                                            â”‚
   â”‚ Process:                                   â”‚
   â”‚ - Create prompt with context               â”‚
   â”‚ - Send to Gemini                           â”‚
   â”‚ - Generate contextual answer               â”‚
   â”‚                                            â”‚
   â”‚ Output: "Based on our knowledge..."       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ UI Flow States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI STATE MACHINE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IDLE
 â”‚
 â”‚ User types message
 â–¼
INPUT_READY
 â”‚
 â”‚ User clicks send / presses Enter
 â–¼
SENDING
 â”‚
 â”‚ API call in progress
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                      â”‚
 â–¼                      â–¼
SUCCESS              ERROR
 â”‚                      â”‚
 â”‚                      â–¼
 â”‚              DISPLAY_ERROR
 â”‚                      â”‚
 â”‚                      â”‚ User dismisses / retries
 â”‚                      â–¼
 â”‚                  IDLE
 â”‚
 â”‚ Display response
 â–¼
MESSAGE_DISPLAYED
 â”‚
 â”‚ User types next message
 â–¼
IDLE (loop)
```

---

## ðŸ“Š Component Communication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMPONENT COMMUNICATION PATTERNS                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend (React)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  HealthChatbot                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ State        â”‚                                         â”‚
â”‚  â”‚ - messages   â”‚                                         â”‚
â”‚  â”‚ - input      â”‚                                         â”‚
â”‚  â”‚ - loading    â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚         â”‚                                                 â”‚
â”‚         â”‚ handleSend()                                    â”‚
â”‚         â–¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ fetch()      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ /api/chat    â”‚             â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                           â”‚
â”‚                               â”‚ HTTP                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
Backend (Next.js)               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  /api/chat/route.ts                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ POST handler â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚         â”‚                                                 â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚                     â”‚                          â”‚
â”‚         â–¼                     â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ FAISS Call   â”‚    â”‚ Genkit Call     â”‚                â”‚
â”‚  â”‚ fetch()      â”‚    â”‚ chatWithRAG()   â”‚                â”‚
â”‚  â”‚ localhost:   â”‚    â”‚                 â”‚                â”‚
â”‚  â”‚ 8000/search  â”‚    â”‚                 â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                     â”‚                          â”‚
â”‚         â”‚ HTTP                â”‚ Internal                 â”‚
â”‚         â”‚                     â”‚                          â”‚
â”‚         â–¼                     â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ FAISS Serviceâ”‚    â”‚ Gemini API      â”‚                â”‚
â”‚  â”‚ (Python)     â”‚    â”‚ (External)      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                    â”‚                                      â”‚
â”‚                    â–¼                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚ Return Response  â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ JSON
                     â”‚
Frontend             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  HealthChatbot                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ Update State â”‚                                         â”‚
â”‚  â”‚ - Add responseâ”‚                                        â”‚
â”‚  â”‚ - Clear input â”‚                                        â”‚
â”‚  â”‚ - Set loading â”‚                                        â”‚
â”‚  â”‚   = false     â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ Render UI    â”‚                                         â”‚
â”‚  â”‚ - Show msg   â”‚                                         â”‚
â”‚  â”‚ - Show sourcesâ”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” Request/Response Formats

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API REQUEST/RESPONSE FLOW                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REQUEST: POST /api/chat
{
  "message": "What are fever symptoms?",
  "userId": "user123",
  "conversationHistory": [
    { "role": "user", "content": "Hello" },
    { "role": "assistant", "content": "Hi! How can I help?" }
  ]
}

    â”‚
    â–¼

INTERNAL: POST http://localhost:8000/search
{
  "query": "What are fever symptoms?",
  "top_k": 5,
  "search_type": "both",
  "user_id": "user123"
}

    â”‚
    â–¼

RESPONSE: From FAISS Service
{
  "diseases_results": [
    {
      "metadata": {
        "name": "Fever",
        "symptoms": "Elevated temperature, chills...",
        "treatments": "..."
      },
      "score": 0.95,
      "distance": 0.05
    }
  ],
  "patient_records_results": [],
  "query_embedding_dimension": 768
}

    â”‚
    â–¼

INTERNAL: chatWithRAG() call
{
  userMessage: "What are fever symptoms?",
  diseasesContext: "Disease 1: Fever\nSymptoms: ...",
  patientRecordsContext: "",
  conversationHistory: [...]
}

    â”‚
    â–¼

RESPONSE: From /api/chat
{
  "response": "Based on our knowledge base, fever symptoms include...",
  "sources": ["Disease Database: Fever"],
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## ðŸ“ˆ Performance Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TIMING BREAKDOWN                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Query Time: ~600-2200ms

Breakdown:
â”œâ”€ Frontend Processing:        ~1ms
â”œâ”€ API Route Handler:          ~5ms
â”œâ”€ FAISS Service Call:         ~50-200ms
â”‚  â”œâ”€ Query Embedding:        ~20-50ms
â”‚  â”œâ”€ Vector Search:          ~10-50ms
â”‚  â””â”€ Metadata Lookup:        ~5-10ms
â”œâ”€ Context Formatting:         ~5ms
â”œâ”€ Genkit/Gemini Call:         ~500-2000ms
â”‚  â”œâ”€ Network Latency:        ~100-300ms
â”‚  â””â”€ Generation Time:        ~400-1700ms
â””â”€ Response Processing:        ~5ms

Optimization Opportunities:
- Cache embeddings for common queries
- Batch multiple queries
- Stream responses (future)
- Use faster index types for larger datasets
```

This comprehensive flow diagram shows every step of the RAG chatbot system!

